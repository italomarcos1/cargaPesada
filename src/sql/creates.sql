CREATE DATABASE TRANSPORTADORA;

USE TRANSPORTADORA;

CREATE TABLE LOCAL(
	UF CHAR(2) UNIQUE,
	CEP CHAR(9) UNIQUE,
	CIDADE VARCHAR(45),
	BAIRRO VARCHAR(45),
	COMPL VARCHAR(45),	/*COMPLEMENTO*/
	PRIMARY KEY(UF,CEP)
);


CREATE TABLE TIPO_CLIENTE(
	IDTIPO_CLIENTE INT PRIMARY KEY NOT NULL,
	NOME VARCHAR(45),		/*(1)PESSOA FISICA OU (2)JURIDICA*/
	NUMCAD VARCHAR(45)		/*NUMERO DE CADASTRO*/
);

CREATE TABLE CLIENTE(
	IDCLIENTE INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(45),
	TELEFONE VARCHAR(30),
	ID_TIPO_CLIENTE INT NOT NULL,			/*FK*/
	LOCAL_UF CHAR(2) NOT NULL,				/*FK*/
	LOCAL_CEP VARCHAR(45) NOT NULL			/*FK*/
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE CLIENTE ADD CONSTRAINT FK_TIPO_CLIENTE
FOREIGN KEY(ID_TIPO_CLIENTE) REFERENCES TIPO_CLIENTE(IDTIPO_CLIENTE);

ALTER TABLE CLIENTE ADD CONSTRAINT FK_CLIENTE_LOCAL_UF
FOREIGN KEY(LOCAL_UF) REFERENCES LOCAL(UF);

ALTER TABLE CLIENTE ADD CONSTRAINT FK_CLIENTE_LOCAL_CEP
FOREIGN KEY(LOCAL_CEP) REFERENCES LOCAL(CEP);


CREATE TABLE TIPO_VEICULO(
	IDTIPO_VEICULO INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(15)
);

CREATE TABLE VEICULO(
	PLACA VARCHAR(10),
	PREFIXO VARCHAR(45),
	PRIMARY KEY(PLACA,PREFIXO),
	MARCA VARCHAR(45),
	MODELO VARCHAR(45),
	NUMREG VARCHAR(45),
	PESOBRUTO FLOAT,
	ANOFAB INT,
	ANOATIV INT,
	TARA FLOAT,
	EIXOS VARCHAR(10),
	KM INT,
	MANUT VARCHAR(45),
	ID_TIPO_VEICULO INT						/*FK*/
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE VEICULO ADD CONSTRAINT FK_TIPO_VEICULO
FOREIGN KEY(ID_TIPO_VEICULO) REFERENCES TIPO_VEICULO(IDTIPO_VEICULO);


CREATE TABLE CARGA(
	LOTENUM INT PRIMARY KEY,
	PESOLIQ FLOAT,
	VEICULO_PLACA VARCHAR(10),				/*FK*/
	VEICULO_PREFIXO VARCHAR(45),			/*FK*/ 
	LOCAL_UF CHAR(2) NOT NULL,				/*FK*/
	LOCAL_CEP VARCHAR(45) NOT NULL			/*FK*/
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE CARGA ADD CONSTRAINT FK_CARGA_VEICULO_PLACA
FOREIGN KEY(VEICULO_PLACA) REFERENCES VEICULO(PLACA);

/*!!!!!!!!!!NAO TA DANDO!!!!!!!!!!!!*/
/*ERROR 1822 (HY000): Failed to add the foreign key constraint. Missing index for constraint 'FK_VEICULO_PREFIXO' in the referenced table 'veiculo'*/
ALTER TABLE CARGA ADD CONSTRAINT FK_CARGA_VEICULO_PREFIXO
FOREIGN KEY(VEICULO_PREFIXO) REFERENCES VEICULO(PREFIXO);			

ALTER TABLE CARGA ADD CONSTRAINT FK_CARGA_LOCAL_UF
FOREIGN KEY(LOCAL_UF) REFERENCES LOCAL(UF);

ALTER TABLE CARGA ADD CONSTRAINT FK_CARGA_LOCAL_CEP
FOREIGN KEY(LOCAL_CEP) REFERENCES LOCAL(CEP);


CREATE TABLE CATEGORIA(
	IDCATEGORIA INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(45)						/*EXEMPLO: INFLAMAVEL*/
);

CREATE TABLE PRODUTO(
	IDPRODUTO INT PRIMARY KEY AUTO_INCREMENT,
	PESO FLOAT,
	ALTURA FLOAT,
	LARGURA FLOAT,
	ID_CATEGORIA INT NOT NULL 				/*FK*/
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE PRODUTO ADD CONSTRAINT FK_PRODUTO_CATEGORIA
FOREIGN KEY(ID_CATEGORIA) REFERENCES CATEGORIA(IDCATEGORIA);

CREATE TABLE PACOTE(
	CODRASTREIO VARCHAR(15) PRIMARY KEY,	/*CODIGO DE RASTREIO*/
	PRECO FLOAT,
	ID_PRODUTO INT,							/*FK*/
	CARGA_LOTENUM INT 						/*FK*/
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE PACOTE ADD CONSTRAINT FK_PACOTE_PRODUTO
FOREIGN KEY(ID_PRODUTO) REFERENCES PRODUTO(IDPRODUTO);

ALTER TABLE PACOTE ADD CONSTRAINT FK_PACOTE_CARGA
FOREIGN KEY(CARGA_LOTENUM) REFERENCES CARGA(LOTENUM);

CREATE TABLE TIPO_FUNCIONARIO(
	IDTIPO_FUNCIONARIO INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(45)						/*MOTORISTA OU OPERADOR*/
);

CREATE TABLE FUNCIONARIO(
	IDFUNCIONARIO INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(45),
	SEXO ENUM('M','F'),
	TELEFONE VARCHAR(45),
	DATAENT DATE,							/*DATA DE CONTRATACAO*/
	HORAS INT,								/*HORAS TRABALHADAS*/
	ID_TIPO_FUNCIONARIO INT,				/*FK*/
	LOCAL_UF CHAR(2),						/*FK*/
	LOCAL_CEP CHAR(9),						/*FK*/
	CARGA_LOTENUM INT						/*FK*/
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE FUNCIONARIO ADD CONSTRAINT FK_TIPO_FUNCIONARIO
FOREIGN KEY(ID_TIPO_FUNCIONARIO) REFERENCES FUNCIONARIO(IDFUNCIONARIO);

ALTER TABLE FUNCIONARIO ADD CONSTRAINT FK_FUNCIONARIO_LOCAL_UF
FOREIGN KEY(LOCAL_UF) REFERENCES LOCAL(UF);

ALTER TABLE FUNCIONARIO ADD CONSTRAINT FK_FUNCIONARIO_LOCAL_CEP
FOREIGN KEY(LOCAL_CEP) REFERENCES LOCAL(CEP);

ALTER TABLE FUNCIONARIO ADD CONSTRAINT FK_FUNCIONARIO_LOTENUM
FOREIGN KEY(CARGA_LOTENUM) REFERENCES CARGA(LOTENUM);

CREATE TABLE MOTORISTA(
	ID_FUNCIONARIO INT, 				/*FK E PK*/
	CNH VARCHAR(45),
	MULTAS INT,
	VALIDADE DATE,
	PRIMARY KEY(ID_FUNCIONARIO)
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE MOTORISTA ADD CONSTRAINT FK_MOTORISTA_FUNCIONARIO
FOREIGN KEY(ID_FUNCIONARIO) REFERENCES FUNCIONARIO(IDFUNCIONARIO);

CREATE TABLE SETOR(
	IDSETOR INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(45),
	LOCAL_UF CHAR(2),						/*FK*/
	LOCAL_CEP CHAR(9)						/*FK*/
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE SETOR ADD CONSTRAINT FK_SETOR_LOCAL_UF
FOREIGN KEY(LOCAL_UF) REFERENCES LOCAL(UF);

ALTER TABLE SETOR ADD CONSTRAINT FK_SETOR_LOCAL_CEP
FOREIGN KEY(LOCAL_CEP) REFERENCES LOCAL(CEP);


CREATE TABLE OPERADOR(
	ID_FUNCIONARIO INT, 				/*FK E PK*/
	ID_SETOR INT,
	PRIMARY KEY(ID_FUNCIONARIO)					
);

/*CRIANDO AS RELACOES ENTRE TABELAS*/
ALTER TABLE OPERADOR ADD CONSTRAINT FK_OPERADOR_FUNCIONARIO
FOREIGN KEY(ID_FUNCIONARIO) REFERENCES FUNCIONARIO(IDFUNCIONARIO);

ALTER TABLE OPERADOR ADD CONSTRAINT FK_OPERADOR_SETOR
FOREIGN KEY(ID_SETOR) REFERENCES SETOR(IDSETOR);
